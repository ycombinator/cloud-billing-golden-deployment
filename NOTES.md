- Golden deployments should be expected to keep running. No clean slate approach.
- Service might be responsible for ensuring golden deployments are up? Could be useful in a flaky environment like QA.
  - Will need to order vars + has with deployment config ID to get deployment ID (== scenario ID?)
  - See https://pkg.go.dev/github.com/hashicorp/hcl/v2#section-readme for parsing out vars and defaults
- Validations should run daily and look back over a sliding window of a day or so.
- Use ILM to clean up test data so data usage is somewhat stable.
  - Part of workload spec?  
- Instead of generating and replaying workloads, dynamically generate and execute them as part of the service (test scenario run).
- For validations, initial implementation could be watcher-based, where validations (incl. thresholds + tolerances) are baked into watches running on the Usage Cluster.
- Getting service into production will most likely be the trickiest part. Not so much because of governance, but more knowing what the latest practices are.

## TODO
- [ ] Implement exercising deployment with workload
- [ ] Switch persistence to State Cluster
- [ ] Read data from Usage Cluster for validations
  - [x] Data Out (`aggregations-proxy-metering-*`)
  - [x] Data Internode (`aggregations-data-transfer-*`)
  - [x] Snapshot API Requests (`usage-v*` for `snapshot_api`)
  - [ ] Snapshot Storage (`storage-blob-filebeat-*`)
- [ ] Read data from PG for validations
  - [ ] Instance Capacity
- [ ] Create watches in State Cluster when scenario is created
- [ ] Use logger
- [ ] Add `is_monitored` flag on scenario definition
- [ ] Implement `PUT /scenario/{id}` API to allow partial update to scenario definition
- [ ] Add snapshot frequency to workload config? ILM configs? Create new data config section?
- [ ] Define Usage Cluster assets in GCM
  - [ ] User: `golden-deployment-service` with role `billing-service` 
- [ ] Define State Cluster assets in GCM
  - [ ] Index templates for definitions index
  - [ ] Index template for validation results time series index
  - [ ] ILM policy for validation results index
  - [ ] One validation watch
- [ ] Create API key for golden deployment in metering-admins@ account and save it as a secret
- [ ] For accessing Usage Cluster, use same method as Billing Service
  - For reads, use billing service role, for writes to state indices, create new role
- [x] Actually start scenario in goroutine
  - [x] Validation loop
    - [x] Usage cluster client singleton?
    - [x] Validate usage cluster connection details at `server` cmd?
    - [x] Store deployment ID/cluster IDs in scenario?
  - [ ] Exercise loop
- [ ] Implement `PUT /deployment_tempalte/{template ID}` API
- [ ] Implement `DELETE /deployment_template/{template ID}` API
- [ ] Implement `DELETE /scenario/{scenario ID}` API
- [ ] Implement logger
- [x] Implement `GET /` API
- [x] Implement `GET /deployment_templates` API
- [x] Implement `GET /deployment_template/{template ID}` API
- [x] Implement `GET /deployment_template/{template ID}/payload` API
- [x] Implement `POST /scenarios` API
- [x] Implement `GET /scenarios` API
- [x] Implement `GET /scenario/{scenario ID}` API
- [x] Handle interrupt and stop scenario runner gracefully
- [x] Use config files
- [x] Use [Cloud Deployments Create API](https://www.elastic.co/guide/en/cloud/current/ec-api-deployment-crud.html#ec_create_a_deployment) instead of TF
- [x] Bug: version override not working / scenario vars not persisting
- [x] Separate state cluster from usage cluster in config
